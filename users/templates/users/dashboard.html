{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>HEY , THIS IS USER DASHBOARD</h1>
    <form method="get" action="{% url 'dashboard' %}">
        <input type="text" name="search" placeholder="Search books by title or category" value="{{ search_query }}">
        <button type="submit">Search</button>
    </form>
    

    <h2>Top 3 Most Borrowed Books</h2>
    <ul>
        {% for book in top_borrowed_books %}
            <li>
                {% if book.image %}
                <img src="{{ book.image.url }}" alt="{{ book.title }}" style="width: 100px; height: auto;">
            {% else %}
                <img src="{% static 'default_book_image.jpg' %}" alt="Default Image" style="width: 100px; height: auto;">
            {% endif %}        
                <a href="{% url 'book_detail' book.pk %}">{{ book.title }}</a> 
                (Borrowed {{ book.borrow_count }} times)
            </li>
        {% empty %}
            <li>No books have been borrowed yet.</li>
        {% endfor %}
    </ul>




<h2>Available Books</h2>

<div>
    <a href="?sort=default" class="{% if current_sort == 'default' %}active{% endif %}">Sort by Title</a> |
    <a href="?sort=borrowed" class="{% if current_sort == 'borrowed' %}active{% endif %}">Sort by Most Borrowed</a>
</div>

<ul>
    {% for book in books %}
        <li>
            {% if book.image %}
            <img src="{{ book.image.url }}" alt="{{ book.title }}" style="width: 100px; height: auto;">
        {% else %}
            <img src="{% static 'default_book_image.jpg' %}" alt="Default Image" style="width: 100px; height: auto;">
        {% endif %}   
            <a href="{% url 'book_detail' book.pk %}">{{ book.title }}</a> by {{ book.author }}
        </li>
    {% endfor %}
</ul>

<h2>Your Borrowings</h2>
<ul>
    {% for borrowing in borrowings %}
        <li>{{ borrowing.book.title }} (Due: {{ borrowing.end_date }})
            <form method="post" action="{% url 'return_book' borrowing.pk %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit">Return</button>
            </form>
            
        </li>
    {% endfor %}
</ul>
{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}
<form method="post" action="{% url 'logout' %}">
    {% csrf_token %}
    <button type="submit">Logout</button>
</form>
</body>
</html>